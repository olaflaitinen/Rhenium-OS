# Rhenium OS Pipeline Configuration
# Liver Ultrasound Lesion Detection Pipeline

name: us_liver_lesion_detection
version: "1.0.0"
description: "Liver ultrasound focal lesion detection and characterization"

pipeline_type: us_liver

# Input configuration
input:
  modality: US
  body_part: LIVER
  modes:
    - B_MODE
  optional_modes:
    - COLOR_DOPPLER
    - CONTRAST_ENHANCED

# Preprocessing steps
preprocessing:
  steps:
    - type: speckle_reduction
      params:
        method: bilateral_filter
        sigma_spatial: 5
        sigma_range: 0.1
    - type: log_compression
      params:
        normalize: true
    - type: liver_segmentation
      params:
        method: deep_learning
    - type: resize
      params:
        target_size: [512, 512]

# Perception models
perception:
  lesion_detection:
    enabled: true
    model: liver_lesion_detection_us_v2
    threshold: 0.4
  lesion_characterization:
    enabled: true
    model: liver_lesion_characterization_v1
    categories:
      - cyst
      - hemangioma
      - focal_nodular_hyperplasia
      - hepatocellular_carcinoma
      - metastasis
      - indeterminate
  liver_echotexture:
    enabled: true
    model: liver_echotexture_assessment_v1
    outputs:
      - normal
      - fatty
      - cirrhotic

# Quantitative analysis
quantification:
  lesion_diameter: true
  lesion_echogenicity: true
  liver_to_kidney_ratio: true

# XAI settings
xai:
  visual:
    enabled: true
    types:
      - lesion_overlay
      - saliency_map
      - roi_highlight
  quantitative:
    enabled: true
    measurements:
      - lesion_max_diameter_mm
      - lesion_count
      - echogenicity_ratio
  narrative:
    enabled: true
    disclaimer: |
      Ultrasound findings are operator-dependent. Clinical correlation 
      and additional imaging may be warranted.

# MedGemma settings
medgemma:
  enabled: true
  template: us_liver_abdomen
  generate_report: true
  explain_findings: true
  validators:
    - narrative_consistency
  uncertainty_emphasis: high  # Emphasize US limitations

# Output settings
output:
  format: json
  include_dossiers: true
  include_clips: false  # Cine clips if available
